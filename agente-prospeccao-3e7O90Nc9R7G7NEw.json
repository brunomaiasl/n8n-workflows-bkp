{"updatedAt":"2025-12-20T22:04:12.000Z","createdAt":"2025-10-05T02:07:16.250Z","id":"3e7O90Nc9R7G7NEw","name":"Agente Prospeccao","active":false,"isArchived":false,"nodes":[{"parameters":{"public":true,"initialMessages":"Bora l√°! ","options":{"subtitle":"Gerador de Oportunidades","title":"ü§ñ[EA] OutboundIA"}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[176,48],"id":"f726f9f7-9962-4cab-9b52-680652106fa8","name":"When chat message received","webhookId":"b5c07b52-fdc5-41bf-8531-a1e562584d53"},{"parameters":{"options":{"systemMessage":"=[SYSTEM PROMPT ‚Äî AGENTE COMERCIAL OUTBOUND | INTENT-DRIVEN]\n\nTESE\nO agente guia, mas adapta a abertura ao que o usu√°rio quer fazer agora. Primeiro detecta inten√ß√£o, depois executa o fluxo m√≠nimo para resultado. Sem rodeios. Sem inven√ß√µes.\n\nDETEC√á√ÉO DE INTEN√á√ÉO (roteador)\nClassifique a √∫ltima mensagem do usu√°rio em exatamente UM tipo:\n1) EXECUTAR BUSCA ‚Äî ‚Äúquero captar‚Äù, ‚Äúbuscar leads‚Äù, ‚Äúprocure X em Y‚Äù\n2) ATUALIZAR/CONSULTAR CRM ‚Äî ‚Äúqual status?‚Äù, ‚Äúmuda para Qualificado‚Äù, ‚Äúpuxa da planilha‚Äù\n3) ENVIAR OUTREACH ‚Äî ‚Äúdispara e-mail/whats‚Äù, ‚Äúcontatar qualificados‚Äù\n4) M√âTRICAS/ESTRAT√âGIA ‚Äî ‚Äúmostre n√∫meros‚Äù, ‚Äúoverview‚Äù, ‚Äúo que fazer agora‚Äù\n5) CONFIGURA√á√ÉO/ICP ‚Äî ‚Äúdefinir ICP‚Äù, ‚Äúajustar campos/status‚Äù\n6) LEGADO (expl√≠cito) ‚Äî ‚Äúuse Busca Negocios Locais‚Äù\n\nABERTURAS POR INTEN√á√ÉO (scripts curtos, 1 bloco, guiados)\n‚Äî EXECUTAR BUSCA\n‚ÄúVou abrir capta√ß√£o. Envie neste formato: Categoria: <texto> | Cidades/UF: <cidade/UF>; ... | Limite: <n>. Recebido ‚Üí chamo buscar_oportunidades por cidade e sigo para CRM.‚Äù\n(Se dados completos j√° vierem, pule a coleta e execute direto.)\n\n‚Äî ATUALIZAR/CONSULTAR CRM\n‚ÄúEntendido. Diga o identificador do lead (e-mail, dom√≠nio, telefone ou ID). Vou consultar no mcp-crm e atualizar status/notas conforme instru√ß√£o.‚Äù\n(Se o usu√°rio fornecer a mudan√ßa desejada, aplique crm.update ap√≥s crm.search/get.)\n\n‚Äî ENVIAR OUTREACH\n‚ÄúPosso disparar apenas para status ‚ÄòQualificado‚Äô. Informe IDs ou filtro (categoria/cidade). Vou checar no mcp-crm, preparar mensagem personalizada e enviar via e-mail/WhatsApp.‚Äù\n(Nunca dispara sem validar status e contato v√°lido.)\n\n‚Äî M√âTRICAS/ESTRAT√âGIA\n‚ÄúVou puxar vis√£o executiva: captados_por_cidade, qualificados, contatos_enviados, taxa_qualifica√ß√£o. Em seguida, recomendo 2‚Äì3 a√ß√µes pr√°ticas.‚Äù\n(Se m√©trica n√£o existir em sess√£o, ler do CRM ou reportar aus√™ncia.)\n\n‚Äî CONFIGURA√á√ÉO/ICP\n‚ÄúDefina rapidamente ICP: segmento, ticket m√≠nimo, regi√£o priorit√°ria, trigger de dor. Eu salvo no CRM e uso nos pr√≥ximos filtros.‚Äù\n\n‚Äî LEGADO\n‚ÄúUsando Busca Negocios Locais conforme solicitado. Formato: ‚Äò<categoria> em <cidade/UF> Brasil‚Äô no parameters0_Value. Tudo mais segue no fluxo padr√£o.‚Äù\n\nCONTRATOS DE FERRAMENTAS (exatos)\n1) buscar_oportunidades\n   IN: { \"categoria\": \"<str>\", \"cidade\": \"<cidade/UF>\", \"limite\": <int> }\n2) mcp-crm\n   - crm.search { \"query\": { \"email\"|\"domain\"|\"phone\"|\"company\"|\"cidade\"|\"categoria\": \"...\" } }\n   - crm.get { \"id\": \"<id>\" }\n   - crm.update { \"id\": \"<id>\", \"data\": { \"status\": \"<Novo|Em Prospec√ß√£o|Qualificado|Em Contato|Follow-up|Perdido|Ganho>\", \"owner\": \"...\", \"notes\": \"...\", \"last_outreach_at\": \"ISO8601\" } }\n3) email.send\n   IN: { \"to\", \"subject\", \"body_text\"|\"body_html\" }  | Pr√©-condi√ß√£o: status == \"Qualificado\"\n4) whatsapp.send\n   IN: { \"phone_e164\", \"message\" }                  | Pr√©-condi√ß√£o: status == \"Qualificado\"\n5) Busca Negocios Locais (legado, sob pedido)\n   IN: { \"parameters0_Value\": \"<categoria> em <cidade/UF> Brasil\" }\n\nFLUXOS OPERACIONAIS (por inten√ß√£o)\n\n[EXECUTAR BUSCA]\n- Se faltarem dados: emitir a linha de coleta e pausar.\n- Se completos:\n  Para cada cidade ‚Üí CALL buscar_oportunidades {categoria, cidade, limite}.\n  Para cada lead:\n    crm.search ‚Üí (se existir) crm.get ‚Üí decidir:\n      ‚Ä¢ Sem avalia√ß√£o ‚Üí status=\"Em Prospec√ß√£o\"\n      ‚Ä¢ Fit ICP confirmado ‚Üí status=\"Qualificado\"\n    crm.update com notes objetivas.\n\n[ATUALIZAR/CONSULTAR CRM]\n- Receber ID/chave ‚Üí crm.search/get ‚Üí crm.update conforme instru√ß√£o expl√≠cita.\n- Registrar notes curtas (o qu√™, por qu√™, por quem).\n\n[ENVIAR OUTREACH]\n- Filtrar no CRM por status=\"Qualificado\" e contatos v√°lidos.\n- Preparar:\n  email.send {to, subject, body_*} com dor/oportunidade/CTA √∫nico curto.\n  whatsapp.send {phone_e164, message} curto com CTA e 2 janelas de hor√°rio.\n- crm.update {last_outreach_at, notes}. Evitar duplicidade se recente.\n\n[M√âTRICAS/ESTRAT√âGIA]\n- Calcular: captados_por_cidade, qualificados, contatos_enviados, taxa_qualifica√ß√£o.\n- Entregar tabela curta + 2‚Äì3 movimentos pr√°ticos (prioriza√ß√£o, limite, ICP).\n\n[CONFIGURA√á√ÉO/ICP]\n- Persistir campos de ICP no CRM. Usar nos pr√≥ximos buscar_oportunidades e na qualifica√ß√£o.\n\nREGRAS DURAS\n- Nunca inventar dados.\n- Contato s√≥ com status ‚ÄúQualificado‚Äù.\n- Sem e-mail/telefone v√°lido ‚Üí n√£o envia.\n- Falha de ferramenta: log curto, 1 retry, sen√£o seguir e anotar pend√™ncia.\n- N√£o marcar ‚ÄúGanho/Perdido‚Äù sem evid√™ncia.\n\nFORMATA√á√ïES PRONTAS\n‚Äî Coleta r√°pida:\n‚ÄúCategoria: <texto> | Cidades/UF: <cidade/UF>; <cidade/UF> | Limite: <n√∫mero>‚Äù\n‚Äî buscar_oportunidades:\nCALL buscar_oportunidades { \"categoria\": \"<c>\", \"cidade\": \"<cidade/UF>\", \"limite\": <n> }\n‚Äî Legado:\nCALL Busca Negocios Locais { \"parameters0_Value\": \"<categoria> em <cidade/UF> Brasil\" }\n‚Äî CRM:\nCALL mcp-crm.search { \"query\": { ... } }\nCALL mcp-crm.get { \"id\": \"<id>\" }\nCALL mcp-crm.update { \"id\": \"<id>\", \"data\": { \"status\": \"<...>\", \"notes\": \"...\" } }\n‚Äî Envio:\nCALL email.send { \"to\": \"<email>\", \"subject\": \"<assunto>\", \"body_text\": \"<mensagem>\" }\nCALL whatsapp.send { \"phone_e164\": \"<+55...>\", \"message\": \"<mensagem>\" }\n\nVERIFICA√á√ÉO DE SENTIDO\n- Abertura agora depende da inten√ß√£o do usu√°rio.\n- O agente mant√©m comando, mas pergunta s√≥ o essencial quando falta dado.\n- Roteador reduz atrito: executa direto quando insumos j√° est√£o presentes.\n- Pr√©-condi√ß√µes e contratos evitam outreach indevido e garantem rastreabilidade.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[384,48],"id":"39a6956e-1f93-4fff-9cb2-eeffc5c4db73","name":"AI Agent"},{"parameters":{"contextWindowLength":50},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[352,272],"id":"c4ef8fc5-cadc-456d-bfbf-8df8b2f53acc","name":"Mem√≥ria"},{"parameters":{"path":"8b75204d-f36e-418f-abd1-7716d63db8ab"},"type":"@n8n/n8n-nodes-langchain.mcpTrigger","typeVersion":2,"position":[528,1264],"id":"150491e1-97b6-4c1b-933c-998cbdfaa325","name":"MCP Server Trigger","webhookId":"8b75204d-f36e-418f-abd1-7716d63db8ab"},{"parameters":{"sseEndpoint":"https://n8n.escoladeautomacao.com/mcp/8b75204d-f36e-418f-abd1-7716d63db8ab","options":{}},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1,"position":[672,272],"id":"58f04ab8-0542-45b7-b573-e1cb5f7df713","name":"mcp_crm"},{"parameters":{"documentId":{"__rl":true,"value":"https://docs.google.com/spreadsheets/d/1unJj4ZI9bGi1UcB3kmk5AyDYVfnNdiXnsJHvbKPlu_M/edit?gid=1185880254#gid=1185880254","mode":"url"},"sheetName":{"__rl":true,"value":1185880254,"mode":"list","cachedResultName":"Leads","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1unJj4ZI9bGi1UcB3kmk5AyDYVfnNdiXnsJHvbKPlu_M/edit#gid=1185880254"},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.6,"position":[32,1488],"id":"578276e1-288a-4601-9a44-13f6a2776161","name":"Get rows","credentials":{"googleSheetsOAuth2Api":{"id":"nnx5ZFRATQAVUQHE","name":"Google Sheets account"}}},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"https://docs.google.com/spreadsheets/d/1unJj4ZI9bGi1UcB3kmk5AyDYVfnNdiXnsJHvbKPlu_M/edit?gid=1185880254#gid=1185880254","mode":"url"},"sheetName":{"__rl":true,"value":1185880254,"mode":"list","cachedResultName":"Leads","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1dckKLrq7_FEUu4CFgpx2lG-gYJvEyx7T4qSsceKk_gE/edit#gid=1185880254"},"columns":{"mappingMode":"defineBelow","value":{"row_number":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('row_number__using_to_match_', ``, 'number') }}","Data Contato":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Data_Contato', ``, 'string') }}","Status":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Status', ``, 'string') }}"},"matchingColumns":["row_number"],"schema":[{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Link GMN","displayName":"Link GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Empresa GMN","displayName":"Empresa GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Categoria","displayName":"Categoria","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Atividades","displayName":"Atividades","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Telefone GMN","displayName":"Telefone GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Telefone Site","displayName":"Telefone Site","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Instagram","displayName":"Instagram","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Website","displayName":"Website","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"CNPJ","displayName":"CNPJ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Endere√ßo","displayName":"Endere√ßo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Nota","displayName":"Nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Qtd Reviews","displayName":"Qtd Reviews","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analise Reviews","displayName":"Analise Reviews","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analise Geral IA","displayName":"Analise Geral IA","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Status","displayName":"Status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Data Contato","displayName":"Data Contato","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Respons√°vel","displayName":"Respons√°vel","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.6,"position":[304,1488],"id":"cd6b7ef1-9d6e-444f-bc89-2d63b21300d9","name":"Update Row","credentials":{"googleSheetsOAuth2Api":{"id":"nnx5ZFRATQAVUQHE","name":"Google Sheets account"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1040,672],"id":"19d9e301-60ac-4244-972c-6ad42a37d776","name":"Loop Over Items"},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"=https://docs.google.com/spreadsheets/d/1unJj4ZI9bGi1UcB3kmk5AyDYVfnNdiXnsJHvbKPlu_M/edit?gid=1185880254#gid=1185880254","mode":"url"},"sheetName":{"__rl":true,"value":1185880254,"mode":"list","cachedResultName":"Leads","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1dckKLrq7_FEUu4CFgpx2lG-gYJvEyx7T4qSsceKk_gE/edit#gid=1185880254"},"columns":{"mappingMode":"defineBelow","value":{"ID":"={{ $('Processar Lead').item.json.place_id }}","Categoria":"={{ $json.message.content.categoria || 'N√£o Identificado' }}","row_number":0,"Telefone Site":"={{ $json.message.content.telefones.celular_whatsapp || 'N√£o Identificado'}}","Email":"={{ $json.message.content.email || 'N√£o Identificado' }}","CNPJ":"={{ $json.message.content.cnpj || 'N√£o Identificado' }}","Instagram":"={{ $json.message.content.instagram || 'N√£o Identificado' }}","Atividades":"={{ $json.message.content.atividades_empresa || 'N√£o Identificado' }}","Analise Geral IA":"={{ $json.message.content.resumo_analitico || 'N√£o Identificado' }}"},"matchingColumns":["ID"],"schema":[{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Link GMN","displayName":"Link GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Empresa GMN","displayName":"Empresa GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Categoria","displayName":"Categoria","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Atividades","displayName":"Atividades","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Telefone GMN","displayName":"Telefone GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Telefone Site","displayName":"Telefone Site","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Website","displayName":"Website","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"CNPJ","displayName":"CNPJ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Endere√ßo","displayName":"Endere√ßo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Instagram","displayName":"Instagram","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Nota","displayName":"Nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Qtd Reviews","displayName":"Qtd Reviews","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analise Reviews","displayName":"Analise Reviews","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analise Geral IA","displayName":"Analise Geral IA","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Status","displayName":"Status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Pr√≥xima A√ß√£o","displayName":"Pr√≥xima A√ß√£o","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Respons√°vel","displayName":"Respons√°vel","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Data Contato","displayName":"Data Contato","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"name":"Update Lead","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[3168,688],"id":"cb79ab7a-0d87-4ee8-9733-ba0eaa09547b","credentials":{"googleSheetsOAuth2Api":{"id":"nnx5ZFRATQAVUQHE","name":"Google Sheets account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"c0e3b2a4-7b1a-4b2c-8d3e-4f5g6h7i8j9k","leftValue":"={{ $('Processar Lead').item.json.textos_avaliacoes }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"name":"Tem Avalia√ß√µes?","type":"n8n-nodes-base.if","typeVersion":2,"position":[2384,912],"id":"5f938e4b-edd1-40cb-a4d6-85f74cf588be"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=AVALIA√á√ïES:\n{{ $('Processar Lead').item.json.textos_avaliacoes }}"},{"content":"=Voc√™ √© um especialista em s√≠ntese de avalia√ß√µes do Google Places para outbound B2B.\n\nEntrada: `reviews` apenas com textos (strings). Use exclusivamente esse conte√∫do.\n\nObjetivos:\n1) Extrair temas positivos e negativos recorrentes.\n2) Resumir a percep√ß√£o geral.\n3) Detectar oportunidades comerciais acion√°veis (ex.: demora/filas ‚Üí agente de triagem; falta de resposta ‚Üí agente de reputa√ß√£o; d√∫vidas repetidas ‚Üí agente de FAQ; agendamentos confusos ‚Üí agente de booking).\n4) Sugerir pr√≥ximo passo de SDR em 1 frase, se houver oportunidade.\n\nPol√≠ticas:\n- Sem inven√ß√µes; cite evid√™ncias por √≠ndice do array e trecho curto.\n- Se dados forem insuficientes, declarar explicitamente.\n- Output ‚â§ 200 tokens; frases curtas; sem redund√¢ncia.\n- M√°x. 3 itens por lista.\n- Portugu√™s; tom t√©cnico e direto.\n\nFormato JSON obrigat√≥rio:\n{\n  \"resumo\": \"‚â§30 palavras\",\n  \"pontos_positivos\": \"‚â§5 palavras ou 'Nenhum identificado'\",\n  \"pontos_negativos\": \"‚â§5 palavras ou 'Nenhum identificado'\",\n  \"percepcao_geral\": \"‚â§20 palavras\",\n  \"oportunidade_oculta\": \"texto breve ou 'Nenhuma identificada'\",\n  \"proximo_passo_sdr\": \"texto breve ou ''\",\n  \"evidencias\": [{\"index\": <int>, \"quote\": \"‚â§12 palavras\"}],\n  \"metricas\": {\n    \"n_avaliacoes\": <int>,\n    \"linguas_detectadas\": [\"pt\", \"en\", \"...\"]\n  },\n  \"confianca\": 0.0-1.0\n}\n","role":"system"}]},"jsonOutput":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[2624,896],"id":"88cf680f-4aa3-4fc1-9d3d-626b8130f9cf","name":"Analise Reviews","credentials":{"openAiApi":{"id":"wX5w2fxZDN4WVLRZ","name":"OpenAi_Key"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"={{ $json.data?.html || 'N√£o foi poss√≠vel extrair o conte√∫do do site.' }}"},{"content":"=Voc√™ √© um especialista em extrair dados comerciais e identificar oportunidades de uso de IA em empresas. Analise o conte√∫do fornecido.\n\nRetorne APENAS um JSON v√°lido com esta estrutura:\n\n{\n  \"email\": string,\n  \"instagram\": string,  // coloque o instagram com @. Exemplo: @fulanodetal\n  \"telefones\": {\n    \"celular_whatsapp\": string,  // DDI+DDD+WhatsApp se existir. Exemplo: 5511900000000\n    \"telefone_fixo\": string,\n    \"outros\": string\n  },\n  \"categoria\": string,\n  \"cnpj\": string,\n  \"atividades_empresa\": string,\n  \"resumo_analitico\": string\n}\n\nINSTRU√á√ïES ESPEC√çFICAS:\n\n1. EMAIL, INSTAGRAM, TELEFONES, CNPJ, ATIVIDADES_EMPRESA:\n   - Mesmas regras anteriores (email principal, @perfil, WhatsApp priorit√°rio, etc.)\n\n2. RESUMO_ANALITICO (NOVA ABORDAGEM):\n   - 3-4 frases estruturadas em: NEG√ìCIO + OPERA√á√ÉO + OPORTUNIDADES\n   - Identifique sinais de possiveis oportunidades\n   - Foque em pontos de dor operacionais (n√£o deduza)\n   - Sugira oportunidades espec√≠ficas baseadas no que viu","role":"system"}]},"jsonOutput":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[2832,512],"id":"eca780a1-f75e-4501-a68d-b2da5aba103e","name":"Analise Site","credentials":{"openAiApi":{"id":"wX5w2fxZDN4WVLRZ","name":"OpenAi_Key"}}},{"parameters":{"assignments":{"assignments":[{"id":"60e14bd3-deaa-4359-b21d-56b383c1ca64","name":"Analise Reviews","value":"=Resumo: {{ $json.message.content.resumo }}\n\nPontos positivos: {{ $json.message.content.pontos_positivos || 'Nenhum identificado' }}\n\nPontos nevativos: {{ $json.message.content.pontos_negativos || 'Nenhum identificado' }}\n\nPercep√ß√£o geral: {{ $json.message.content.percepcao_geral }}\n\nOportunidade oculta: {{ $json.message.content.oportunidade_oculta }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2992,896],"id":"3e069e75-fcaa-479b-8469-39d137530a5b","name":"SetResumo"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"={{ $('Processar Lead').item.json.empresa }} \n{{ $('Processar Lead').item.json.textos_avaliacoes }}"},{"content":"=Voc√™ √© um especialista em extrair dados comerciais e identificar possiveis oportunidades de implementa√ß√£o de agentes de IA em empresas. Analise o conte√∫do e extraia as informa√ß√µes solicitadas.\n\nRetorne APENAS um JSON v√°lido com esta estrutura:\n\n{\n  \"email\": string,\n  \"instagram\": string, (coloque o instagram com o @. Exemplo: @fulanodetal)\n  \"telefones\": {\n    \"celular_whatsapp\": string, (se existir DDI DDD e Whatsapp. Exemplo: 5511900000000)\n    \"telefone_fixo\": string,\n    \"outros\": string\n  },\n  \"categoria\": string,\n  \"cnpj\": string,\n  \"atividades_empresa\": string,\n  \"resumo_analitico\": string\n}\n\nINSTRU√á√ïES ESPEC√çFICAS:\n\n1. EMAIL, INSTAGRAM, TELEFONES, CNPJ, ATIVIDADES_EMPRESA:\n   - Mesmas regras anteriores (email principal, @perfil, WhatsApp priorit√°rio, etc.)\n\n2. RESUMO_ANALITICO (NOVA ABORDAGEM):\n   - 3-4 frases estruturadas em: NEG√ìCIO + OPERA√á√ÉO + OPORTUNIDADES\n   - Identifique sinais de possiveis oportunidades\n   - Foque em pontos de dor operacionais (n√£o deduza)\n   - Sugira oportunidades espec√≠ficas baseadas no que viu","role":"system"}]},"jsonOutput":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[2624,688],"id":"cf48aa91-856c-44bb-a858-05975c77182b","name":"Analise GMN","credentials":{"openAiApi":{"id":"wX5w2fxZDN4WVLRZ","name":"OpenAi_Key"}}},{"parameters":{"method":"POST","url":"https://places.googleapis.com/v1/places:searchText","sendQuery":true,"queryParameters":{"parameters":[{"name":"key","value":"AIzaSyCPGjgTx32mQDqoBY_2JekpYGVIDOKzY3Q"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Goog-FieldMask","value":"places.id,places.displayName,places.formattedAddress,places.location"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"textQuery","value":"={{ $json.categoria }} in {{ $json.cidade }}"},{"name":"pageSize","value":"={{ $json.limite }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[576,672],"id":"64984298-92ac-4954-8530-8176dcd531c2","name":"Buscar Neg√≥cios"},{"parameters":{"fieldToSplitOut":"places","options":{}},"name":"Separar","type":"n8n-nodes-base.itemLists","typeVersion":3,"position":[816,672],"id":"d233e690-6f96-4f49-8963-591c83c72939"},{"parameters":{"documentId":{"__rl":true,"value":"=https://docs.google.com/spreadsheets/d/1unJj4ZI9bGi1UcB3kmk5AyDYVfnNdiXnsJHvbKPlu_M/edit?gid=1185880254#gid=1185880254\n\n","mode":"url"},"sheetName":{"__rl":true,"value":1185880254,"mode":"list","cachedResultName":"Leads","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1dckKLrq7_FEUu4CFgpx2lG-gYJvEyx7T4qSsceKk_gE/edit#gid=1185880254"},"filtersUI":{"values":[{"lookupColumn":"ID","lookupValue":"={{ $json.id }}"}]},"options":{"dataLocationOnSheet":{"values":{"rangeDefinition":"specifyRange","firstDataRow":5}}}},"name":"Verificar Lead Existente","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[1312,688],"id":"4b7470b4-3210-4378-8f79-278bb521ac87","alwaysOutputData":true,"credentials":{"googleSheetsOAuth2Api":{"id":"nnx5ZFRATQAVUQHE","name":"Google Sheets account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":1},"conditions":[{"id":"c0e3b2a4-7b1a-4b2c-8d3e-4f5g6h7i8j9k","leftValue":"={{ $json.ID }}","rightValue":"=1","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{"looseTypeValidation":true}},"name":"Lead Novo?","type":"n8n-nodes-base.if","typeVersion":2,"position":[1536,688],"id":"ac526632-f024-4d58-a853-cf44ceadbf2c"},{"parameters":{"url":"=https://places.googleapis.com/v1/places/{{ $('Loop Over Items').item.json.id }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"key","value":"AIzaSyCPGjgTx32mQDqoBY_2JekpYGVIDOKzY3Q"},{"name":"languageCode","value":"pt-BR"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Goog-FieldMask","value":"id,displayName,formattedAddress,location,websiteUri,nationalPhoneNumber,rating,userRatingCount,regularOpeningHours,photos,reviews,googleMapsUri,reservable,internationalPhoneNumber"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1760,672],"id":"1d80daaa-5d56-4548-83e6-b6b0adfb909b","name":"Detalhes Negocio"},{"parameters":{"jsCode":"// Processar dados da empresa e determinar qualidade\nconst data = $input.item.json;\n\n// --------- Configura√ß√µes internas (sem depender de outro n√≥) ---------\n// Ajuste aqui os crit√©rios-padr√£o:\nconst DEFAULT_RATING_MIN = 4.0;\nconst DEFAULT_REVIEWS_MIN = 20;\n\n// (Opcional) permitir override via pr√≥prio item de entrada:\n// Ex.: envie rating_min / reviews_min dentro do mesmo JSON\nconst RATING_MIN = Number.isFinite(data.rating_min) ? Number(data.rating_min) : DEFAULT_RATING_MIN;\nconst REVIEWS_MIN = Number.isFinite(data.reviews_min) ? Number(data.reviews_min) : DEFAULT_REVIEWS_MIN;\n// ---------------------------------------------------------------------\n\n// Calcular ID √∫nico\nconst leadId = String(data.id || '').substring(0, 8);\n\n// Determinar status inicial baseado em crit√©rios\nlet status = 'Novo';\nlet qualidadeSite = 'Sem Site';\nlet proximaAcao = 'Buscar Dados';\n\n// Verificar se tem website\nif (data.websiteUri) {\n  proximaAcao = 'Analisar Oportunidade';\n  qualidadeSite = 'Com Site';\n}\n\n// Qualificar automaticamente se atende crit√©rios das configura√ß√µes internas\nif ((data.rating || 0) >= RATING_MIN && (data.userRatingCount || 0) >= REVIEWS_MIN) {\n  status = 'Qualificado';\n}\n\n// Determinar se tem email (ser√° preenchido depois)\nconst temEmail = 'Buscar Dados';\n\n// Extrair nome da empresa do displayName\nconst nomeEmpresa = data.displayName?.text || 'N/A';\n\n// Extrair telefone (usar nationalPhoneNumber se dispon√≠vel, sen√£o internationalPhoneNumber)\nconst telefone = data.nationalPhoneNumber || data.internationalPhoneNumber || '';\n\n// Extrair endere√ßo completo (sem separar cidade)\nconst enderecoCompleto = data.formattedAddress || '';\n\n// Extrair nota e quantidade de avalia√ß√µes separadamente\nconst notaAvaliacao = data.rating || 0;\nconst quantidadeAvaliacoes = data.userRatingCount || 0;\n\n// Extrair TODAS as avalia√ß√µes dispon√≠veis (n√£o limitar a 3)\nlet textosAvaliacoes = '';\nif (Array.isArray(data.reviews)) {\n  textosAvaliacoes = data.reviews\n    .map(review => {\n      const autor = review.authorAttribution?.displayName || 'An√¥nimo';\n      const nota = review.rating || 0;\n      const texto = review.text?.text || review.originalText?.text || '';\n      const tempo = review.relativePublishTimeDescription || '';\n      return `[${autor} - ${nota}‚òÖ - ${tempo}]: ${texto}`;\n    })\n    .join('\\n\\n');\n}\n\n// Extrair hor√°rio de funcionamento\nlet horarioFuncionamento = '';\nif (Array.isArray(data.regularOpeningHours?.weekdayDescriptions)) {\n  horarioFuncionamento = data.regularOpeningHours.weekdayDescriptions.join(', ');\n}\n\n// Determinar categoria (primaryType se dispon√≠vel)\nconst categoria = data.primaryType || data.types?.[0] || 'Neg√≥cio Local';\n\n// Criar observa√ß√µes mais detalhadas\nconst observacoes = [\n  `Rating: ${notaAvaliacao} (${quantidadeAvaliacoes} avalia√ß√µes)`,\n  enderecoCompleto ? `Endere√ßo: ${enderecoCompleto}` : '',\n  horarioFuncionamento ? `Hor√°rio: ${horarioFuncionamento}` : '',\n  data.websiteUri ? `Site: ${data.websiteUri}` : '',\n  data.googleMapsUri ? `Maps: ${data.googleMapsUri}` : ''\n].filter(Boolean).join(' | ');\n\nreturn {\n  id: leadId,\n  empresa: nomeEmpresa,\n  categoria: categoria,\n  telefone: telefone,\n  endereco_completo: enderecoCompleto,\n  website: data.websiteUri || '',\n  status: status,\n  tem_email: temEmail,\n  qualidade_site: qualidadeSite,\n  proxima_acao: proximaAcao,\n  responsavel: '',\n  data_contato: '',\n  nota_avaliacao: notaAvaliacao,\n  quantidade_avaliacoes: quantidadeAvaliacoes,\n  textos_avaliacoes: textosAvaliacoes,\n  horario_funcionamento: horarioFuncionamento,\n  observacoes: observacoes,\n  place_id: data.id || '',\n  google_maps_uri: data.googleMapsUri || '',\n  // Expor crit√©rios usados (√∫til para auditoria)\n  criterios: { RATING_MIN, REVIEWS_MIN }\n};\n"},"name":"Processar Lead","type":"n8n-nodes-base.code","typeVersion":2,"position":[1984,672],"id":"dd2abcd1-eedf-4582-8b22-451ba90ef6bd"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"=https://docs.google.com/spreadsheets/d/1unJj4ZI9bGi1UcB3kmk5AyDYVfnNdiXnsJHvbKPlu_M/edit?gid=1185880254#gid=1185880254","mode":"url"},"sheetName":{"__rl":true,"value":1185880254,"mode":"list","cachedResultName":"Leads","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1dckKLrq7_FEUu4CFgpx2lG-gYJvEyx7T4qSsceKk_gE/edit#gid=1185880254"},"columns":{"mappingMode":"defineBelow","value":{"ID":"={{ $json.place_id }}","Website":"={{ $json.website || 'N√£o Identificado'}}","Status":"=Novo","Empresa GMN":"={{ $json.empresa }}","Telefone GMN":"={{ $json.telefone  || 'N√£o Identificado'}}","Link GMN":"={{ $json.google_maps_uri }}","Endere√ßo":"={{ $json.endereco_completo }}","Qtd Reviews":"={{ $json.quantidade_avaliacoes }}","Nota":"={{ $json.nota_avaliacao }}"},"matchingColumns":[],"schema":[{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Link GMN","displayName":"Link GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Empresa GMN","displayName":"Empresa GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Categoria","displayName":"Categoria","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Atividades","displayName":"Atividades","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Telefone GMN","displayName":"Telefone GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Telefone Site","displayName":"Telefone Site","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Instagram","displayName":"Instagram","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Website","displayName":"Website","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"CNPJ","displayName":"CNPJ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Endere√ßo","displayName":"Endere√ßo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Nota","displayName":"Nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Qtd Reviews","displayName":"Qtd Reviews","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analise Reviews","displayName":"Analise Reviews","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analise Geral IA","displayName":"Analise Geral IA","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Status","displayName":"Status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Data Contato","displayName":"Data Contato","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Respons√°vel","displayName":"Respons√°vel","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"name":"Adicionar Lead","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[2192,672],"id":"5e0281f3-34dd-4f3c-900f-af478d19a431","credentials":{"googleSheetsOAuth2Api":{"id":"nnx5ZFRATQAVUQHE","name":"Google Sheets account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"c0e3b2a4-7b1a-4b2c-8d3e-4f5g6h7i8j9k","leftValue":"={{ $('Processar Lead').item.json.website }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"3774c31d-ebd9-47c6-a09a-0c6f59997b10","leftValue":"={{ $json.Website }}","rightValue":"=facebook","operator":{"type":"string","operation":"notContains"}},{"id":"be7a803d-77d5-40be-abc0-70829e0b7115","leftValue":"={{ $json.Website }}","rightValue":"instagram","operator":{"type":"string","operation":"notContains"}}],"combinator":"and"},"options":{}},"name":"Tem Site?","type":"n8n-nodes-base.if","typeVersion":2,"position":[2384,672],"id":"2eafba4e-f0f0-4e24-adbd-4877d7e5d35e"},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"=https://docs.google.com/spreadsheets/d/1unJj4ZI9bGi1UcB3kmk5AyDYVfnNdiXnsJHvbKPlu_M/edit?gid=1185880254#gid=1185880254","mode":"url"},"sheetName":{"__rl":true,"value":1185880254,"mode":"list","cachedResultName":"Leads","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1dckKLrq7_FEUu4CFgpx2lG-gYJvEyx7T4qSsceKk_gE/edit#gid=1185880254"},"columns":{"mappingMode":"defineBelow","value":{"ID":"={{ $('Processar Lead').item.json.place_id }}","row_number":0,"Analise Reviews":"={{ $json[\"Analise Reviews\"] }}"},"matchingColumns":["ID"],"schema":[{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Link GMN","displayName":"Link GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Empresa GMN","displayName":"Empresa GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Categoria","displayName":"Categoria","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Atividades","displayName":"Atividades","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Telefone GMN","displayName":"Telefone GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Telefone Site","displayName":"Telefone Site","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Website","displayName":"Website","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"CNPJ","displayName":"CNPJ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Endere√ßo","displayName":"Endere√ßo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Instagram","displayName":"Instagram","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Nota","displayName":"Nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Qtd Reviews","displayName":"Qtd Reviews","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analise Reviews","displayName":"Analise Reviews","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analise Geral IA","displayName":"Analise Geral IA","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Status","displayName":"Status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Pr√≥xima A√ß√£o","displayName":"Pr√≥xima A√ß√£o","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Respons√°vel","displayName":"Respons√°vel","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Data Contato","displayName":"Data Contato","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"name":"Update Review","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[3168,896],"id":"074846d9-d62a-44d5-9831-15720c08aabf","credentials":{"googleSheetsOAuth2Api":{"id":"nnx5ZFRATQAVUQHE","name":"Google Sheets account"}}},{"parameters":{"method":"POST","url":"https://api.firecrawl.dev/v2/scrape","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer fc-0574544bfd4045aea7adb68ef5dcba98"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"url\": \"{{ $('Processar Lead').item.json.website ? ($('Processar Lead').item.json.website.startsWith('http') ? $('Processar Lead').item.json.website : 'https://' + $('Processar Lead').item.json.website) : '' }}\",\n  \"onlyMainContent\": false,\n  \"maxAge\": 172800000,\n  \"parsers\": [\"pdf\"],\n  \"formats\": [\"html\"]\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2656,512],"id":"7695d3e9-09bc-4bf7-95ef-466db6b52fd4","name":"Scrap-Site","onError":"continueRegularOutput"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1312,512],"id":"ac9a2bde-cd32-4ed4-b81c-8ea8c48f2652","name":"No Operation"},{"parameters":{"assignments":{"assignments":[{"id":"f5525c97-171e-44a8-9784-128713fbaf18","name":"API Places","value":"AIzaSyCPGjgTx32mQDqoBY_2JekpYGVIDOKzY3Q","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[368,672],"id":"bae421cf-58d6-404c-ae2e-c24b67b59831","name":"Configs"},{"parameters":{"workflowInputs":{"values":[{"name":"categoria"},{"name":"cidade"},{"name":"limite"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[160,672],"id":"774f68a3-b3fd-4a55-b4f3-e3bfe94a8460","name":"When Executed by Another Workflow"},{"parameters":{"description":"Acionar essa Tool para encontrar oportunidades de neg√≥cios","workflowId":{"__rl":true,"value":"3e7O90Nc9R7G7NEw","mode":"id","cachedResultUrl":"/workflow/3e7O90Nc9R7G7NEw"},"workflowInputs":{"mappingMode":"defineBelow","value":{"categoria":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('categoria', ``, 'string') }}","cidade":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('cidade', ``, 'string') }}","limite":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('limite', ``, 'string') }}"},"matchingColumns":[],"schema":[{"id":"categoria","displayName":"categoria","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"cidade","displayName":"cidade","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"limite","displayName":"limite","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[512,272],"id":"7f3645fb-3de9-4255-a889-631c6ddea76e","name":"buscar_negocios"},{"parameters":{"content":"## -- IA Agent","height":416,"width":864,"color":5},"type":"n8n-nodes-base.stickyNote","position":[0,0],"typeVersion":1,"id":"e6ec75f6-f87d-424d-9aa3-c0ba7dfca5c6","name":"Sticky Note"},{"parameters":{"content":"## -- Fluxo Outbound","height":672,"width":3440,"color":5},"type":"n8n-nodes-base.stickyNote","position":[0,480],"typeVersion":1,"id":"d745c33c-b3bf-4b23-aadf-165c464a085f","name":"Sticky Note1"},{"parameters":{"content":"## -- MCP Server","height":432,"width":784,"color":5},"type":"n8n-nodes-base.stickyNote","position":[0,1216],"typeVersion":1,"id":"0a044c0f-af26-48f7-a542-572b4e812962","name":"Sticky Note2"},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"https://docs.google.com/spreadsheets/d/1unJj4ZI9bGi1UcB3kmk5AyDYVfnNdiXnsJHvbKPlu_M/edit?gid=1185880254#gid=1185880254","mode":"url"},"sheetName":{"__rl":true,"value":1185880254,"mode":"list","cachedResultName":"Leads","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1dckKLrq7_FEUu4CFgpx2lG-gYJvEyx7T4qSsceKk_gE/edit#gid=1185880254"},"columns":{"mappingMode":"defineBelow","value":{"row_number":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('row_number__using_to_match_', ``, 'number') }}","Data Contato":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Data_Contato', ``, 'string') }}","Status":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Status', ``, 'string') }}"},"matchingColumns":["row_number"],"schema":[{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Link GMN","displayName":"Link GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Empresa GMN","displayName":"Empresa GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Categoria","displayName":"Categoria","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Atividades","displayName":"Atividades","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Telefone GMN","displayName":"Telefone GMN","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Telefone Site","displayName":"Telefone Site","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Instagram","displayName":"Instagram","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Website","displayName":"Website","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"CNPJ","displayName":"CNPJ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Endere√ßo","displayName":"Endere√ßo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Nota","displayName":"Nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Qtd Reviews","displayName":"Qtd Reviews","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analise Reviews","displayName":"Analise Reviews","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analise Geral IA","displayName":"Analise Geral IA","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Status","displayName":"Status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Data Contato","displayName":"Data Contato","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Respons√°vel","displayName":"Respons√°vel","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.6,"position":[160,1488],"id":"14055bde-c07f-4876-a7a0-73b9e0ab5e16","name":"Add Row","credentials":{"googleSheetsOAuth2Api":{"id":"nnx5ZFRATQAVUQHE","name":"Google Sheets account"}}},{"parameters":{"sendTo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', ``, 'string') }}","subject":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}","message":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[448,1488],"id":"e470c95f-baa2-4178-9730-998de1c138ff","name":"Send Email","webhookId":"0637ca5b-6a3e-4061-afca-d43656f7bdf3","credentials":{"gmailOAuth2":{"id":"AAvoHJe4y1pn8l2R","name":"Gmail account"}}},{"parameters":{"method":"POST","url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[608,1488],"id":"78cf5c84-3acf-46bf-9a5e-3f358ceddc5c","name":"Evo: Send Messsage"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[176,272],"id":"7da35180-6e3d-4fe8-b34b-6a266f3e5210","name":"GPT4.1","credentials":{"openAiApi":{"id":"wX5w2fxZDN4WVLRZ","name":"OpenAi_Key"}}}],"connections":{"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Mem√≥ria":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"mcp_crm":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Get rows":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"Update Row":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"Loop Over Items":{"main":[[{"node":"No Operation","type":"main","index":0}],[{"node":"Verificar Lead Existente","type":"main","index":0}]]},"Update Lead":{"main":[[{"node":"Tem Avalia√ß√µes?","type":"main","index":0}]]},"Tem Avalia√ß√µes?":{"main":[[{"node":"Analise Reviews","type":"main","index":0}],[{"node":"Loop Over Items","type":"main","index":0}]]},"Analise Reviews":{"main":[[{"node":"SetResumo","type":"main","index":0}]]},"Analise Site":{"main":[[{"node":"Update Lead","type":"main","index":0}]]},"SetResumo":{"main":[[{"node":"Update Review","type":"main","index":0}]]},"Analise GMN":{"main":[[{"node":"Update Lead","type":"main","index":0}]]},"Buscar Neg√≥cios":{"main":[[{"node":"Separar","type":"main","index":0}]]},"Separar":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Verificar Lead Existente":{"main":[[{"node":"Lead Novo?","type":"main","index":0}]]},"Lead Novo?":{"main":[[{"node":"Detalhes Negocio","type":"main","index":0}],[{"node":"Loop Over Items","type":"main","index":0}]]},"Detalhes Negocio":{"main":[[{"node":"Processar Lead","type":"main","index":0}]]},"Processar Lead":{"main":[[{"node":"Adicionar Lead","type":"main","index":0}]]},"Adicionar Lead":{"main":[[{"node":"Tem Site?","type":"main","index":0}]]},"Tem Site?":{"main":[[{"node":"Scrap-Site","type":"main","index":0}],[{"node":"Analise GMN","type":"main","index":0}]]},"Update Review":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Scrap-Site":{"main":[[{"node":"Analise Site","type":"main","index":0}]]},"Configs":{"main":[[{"node":"Buscar Neg√≥cios","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Configs","type":"main","index":0}]]},"buscar_negocios":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Add Row":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"Send Email":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"Evo: Send Messsage":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"GPT4.1":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When chat message received":[{"json":{"sessionId":"9cbea9bab9634b6db32c519f0c69d091","action":"sendMessage","chatInput":"buscar clinica de estetica em Campinas/SP"}}]},"versionId":"7ee69a13-f76a-43a5-aa16-491d85c41e9a","triggerCount":2,"shared":[{"updatedAt":"2025-10-05T02:07:16.261Z","createdAt":"2025-10-05T02:07:16.261Z","role":"workflow:owner","workflowId":"3e7O90Nc9R7G7NEw","projectId":"G56NELttT2pGfqmo"}],"tags":[]}